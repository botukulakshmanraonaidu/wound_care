<!DOCTYPE html>
<html>

<head>
    <style>
        @page {
            size: A4;
            margin: 1.5cm 2cm;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            color: #0f172a;
            line-height: 1.15;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }

        /* Layout Tables */
        .full-width {
            width: 482pt;
            border-collapse: collapse;
        }

        /* Header Styling */
        .doc-header-table {
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 8pt;
            margin-bottom: 10pt;
            width: 482pt;
        }

        .logo-img {
            width: 45pt;
            height: 45pt;
        }

        .brand-container {
            padding-left: 2pt;
            vertical-align: middle;
        }

        .brand-text-large {
            font-size: 18pt;
            font-weight: 900;
            color: #0f172a;
            line-height: 1.0;
            letter-spacing: -0.5px;
            margin: 0;
            padding: 0;
        }

        .brand-subtitle {
            font-size: 9.75pt;
            font-weight: 700;
            color: #475569;
            margin-top: 1pt;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            line-height: 1.0;
        }

        .doc-meta {
            font-size: 10.5pt;
            color: #64748b;
            text-align: right;
            font-weight: 500;
        }

        .status-badge {
            background-color: #f0fdf4;
            color: #166534;
            border: 1px solid #dcfce7;
            padding: 4.5pt 12pt;
            border-radius: 15pt;
            font-size: 9pt;
            font-weight: 800;
            text-transform: uppercase;
        }

        /* Patient Information Grid */
        .patient-grid-container {
            background-color: #f8fafc;
            border-radius: 6pt;
            padding: 10pt 12pt;
            margin-bottom: 14pt;
            width: 482pt;
        }

        .detail-item {
            vertical-align: top;
            padding: 0pt 5pt;
        }

        .detail-label {
            font-size: 7.5pt;
            font-weight: 700;
            color: #94a3b8;
            margin-bottom: 4pt;
            text-transform: uppercase;
        }

        .detail-value {
            font-size: 10.5pt;
            font-weight: 600;
            color: #0f172a;
        }

        .section-header {
            font-size: 12pt;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 12pt;
        }

        .section-num {
            background-color: #0f172a;
            color: #ffffff;
            width: 18pt;
            height: 18pt;
            text-align: center;
            display: inline-block;
            font-size: 9pt;
            font-weight: 600;
            border-radius: 9pt;
            margin-right: 8pt;
            line-height: 18pt;
        }

        /* Tables */
        .m-table {
            width: 100%;
            margin-bottom: 15px;
            border-collapse: collapse;
        }

        .m-table th {
            text-align: left;
            font-size: 8.25pt;
            color: #94a3b8;
            padding: 6pt 4pt;
            border-bottom: 1pt solid #f1f5f9;
            font-weight: 700;
            text-transform: uppercase;
        }

        .m-table td {
            font-size: 9.75pt;
            padding: 8pt 4pt;
            border-bottom: 1pt solid #f1f5f9;
            color: #0f172a;
            font-weight: 500;
        }

        .m-table td.metric-name {
            color: #64748b;
            font-size: 9pt;
        }

        .m-table td.metric-val {
            color: #0f172a;
            font-weight: 700;
        }

        .m-table td.status-col {
            color: #64748b;
            font-size: 9pt;
        }

        .metric-improving {
            color: #16a34a;
            font-weight: 800;
        }

        .metric-worsening {
            color: #ef4444;
            font-weight: 800;
        }

        /* AI Confidence */
        .ai-conf-badge {
            display: inline-block;
            background: #6366f1;
            color: #ffffff;
            font-size: 8pt;
            font-weight: 800;
            padding: 2pt 7pt;
            border-radius: 4pt;
            margin-right: 5pt;
        }

        /* Composition Bars */
        .comp-label-row {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 3pt;
        }

        .comp-bar-row {
            width: 100%;
            background-color: #f1f5f9;
            border-radius: 3pt;
            height: 6pt;
            margin-bottom: 11pt;
            border-collapse: collapse;
        }

        /* AI Analysis Notes */
        .analysis-box {
            background-color: #fffbeb;
            border-left: 3pt solid #f59e0b;
            padding: 10pt;
            border-radius: 0 6pt 6pt 0;
            margin-top: 5pt;
            margin-bottom: 12pt;
        }

        .analysis-title {
            font-size: 9.75pt;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 4px;
        }

        .analysis-text {
            font-size: 9.75pt;
            color: #475569;
            line-height: 1.4;
            margin-bottom: 10px;
        }

        .rec-box {
            background-color: #f0f9ff;
            border-left: 3pt solid #0284c7;
            padding: 8pt;
            border-radius: 0 6pt 6pt 0;
        }

        .rec-title {
            font-size: 9.75pt;
            font-weight: 700;
            color: #0369a1;
            margin-bottom: 4pt;
        }

        .rec-text {
            font-size: 9.75pt;
            color: #0c4a6e;
            font-weight: 500;
            line-height: 1.4;
        }

        /* Images */
        .wound-image {
            width: 100%;
            border-radius: 6pt;
            border: 1pt solid #f1f5f9;
            margin-bottom: 0;
            display: block;
        }

        .image-caption {
            font-size: 8pt;
            color: #ffffff;
            background-color: #334155;
            padding: 3pt 8pt;
            margin-bottom: 10pt;
        }

        /* Footer */
        .footer {
            border-top: 1pt solid #f1f5f9;
            margin-top: 30pt;
            padding-top: 12pt;
            font-size: 8.25pt;
            color: #94a3b8;
        }

        .wound-info-chip {
            display: inline-block;
            background: #f1f5f9;
            border-radius: 4pt;
            padding: 2pt 7pt;
            font-size: 9pt;
            font-weight: 600;
            color: #334155;
            margin-right: 4pt;
            margin-bottom: 4pt;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <div style="margin-bottom: 12pt;">
        <table class="doc-header-table full-width">
            <tr>
                <td style="width: 70%;">
                    <table style="border-collapse: collapse;">
                        <tr>
                            <td style="width: 54pt; vertical-align: middle; text-align: left;">
                                <img src="/static/images/project_logo.svg" class="logo-img" style="margin-left: -15pt;">
                            </td>
                            <td class="brand-container" style="text-align: left;">
                                <div class="brand-text-large">Wound Assessment Tool</div>
                                <div class="brand-subtitle">Hospital - Grade Diagnostics</div>
                            </td>
                        </tr>
                    </table>
                </td>
                <td style="width: 30%; text-align: right; vertical-align: middle;">
                    <div class="doc-meta">
                        Generated on {{ report_date }}
                    </div>
                    <div style="margin-top: 6pt;">
                        <span class="status-badge">Finalized Report</span>
                    </div>
                </td>
            </tr>
        </table>

        <!-- Patient Details -->
        <div class="patient-grid-container">
            <table class="full-width">
                <tr>
                    <td class="detail-item" style="width: 20%;">
                        <div class="detail-label">NAME</div>
                        <div class="detail-value">{{ patient.first_name }} {{ patient.last_name }}</div>
                    </td>
                    <td class="detail-item" style="width: 20%;">
                        <div class="detail-label">MRN</div>
                        <div class="detail-value">{{ patient.mrn }}</div>
                    </td>
                    <td class="detail-item" style="width: 20%;">
                        <div class="detail-label">DOB</div>
                        <div class="detail-value">{{ patient.date_of_birth }}</div>
                    </td>
                    <td class="detail-item" style="width: 20%;">
                        <div class="detail-label">LOCATION</div>
                        <div class="detail-value">{{ assessment.body_location|default:"N/A" }}</div>
                    </td>
                    <td class="detail-item" style="width: 20%;">
                        <div class="detail-label">ASSESSED BY</div>
                        <div class="detail-value">{% if doctor %}Dr. {{ doctor.full_name }}{% else %}N/A{% endif %}
                        </div>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Main 2-Column Grid -->
    <table class="full-width">
        <tr>
            <!-- LEFT COLUMN -->
            <td style="width: 218pt; vertical-align: top; padding-right: 24pt;">

                <!-- Section 1: Visual Assessment -->
                <div class="section-header"><span class="section-num">1</span> Visual Assessment</div>
                <div style="margin-bottom: 18pt;">
                    {% if images %}
                    {% for img in images %}
                    <div
                        style="border-radius: 8pt; border: 1pt solid #e2e8f0; background-color: #f1f5f9; overflow: hidden; margin-bottom: 8pt;">
                        <img src="{{ img.full_image.url }}"
                            style="width: 218pt; display: block; max-height: 160pt; object-fit: cover;">
                        <div class="image-caption">Captured on {{ img.created_at|date:"d/m/Y" }}</div>
                    </div>
                    {% endfor %}
                    {% else %}
                    <div
                        style="padding: 30pt; background: #f8fafc; border: 1pt dashed #e2e8f0; color: #94a3b8; text-align: center; font-size: 9pt; border-radius: 8pt;">
                        No assessment images available
                    </div>
                    {% endif %}
                </div>

                <!-- Wound Info Chips -->
                <div style="margin-bottom: 12pt;">
                    {% if assessment.wound_type %}
                    <span class="wound-info-chip">{{ assessment.wound_type }}</span>
                    {% endif %}
                    {% if assessment.wound_stage %}
                    <span class="wound-info-chip">{{ assessment.wound_stage }}</span>
                    {% endif %}
                    {% if assessment.pain_level %}
                    <span class="wound-info-chip">Pain: {{ assessment.pain_level }}/10</span>
                    {% endif %}
                    {% if assessment.exudate_amount %}
                    <span class="wound-info-chip">Exudate: {{ assessment.exudate_amount }}</span>
                    {% endif %}
                </div>

                <!-- Section 2: Measurements & Progress -->
                <div class="section-header"><span class="section-num">2</span> Measurements &amp; Progress</div>
                <table class="m-table">
                    <tr>
                        <th>METRIC</th>
                        <th>VALUE</th>
                        <th>STATUS</th>
                    </tr>
                    <tr>
                        <td class="metric-name">Max Length</td>
                        <td class="metric-val">{{ assessment.length|default:"--" }} cm</td>
                        <td class="status-col">Current</td>
                    </tr>
                    <tr>
                        <td class="metric-name">Max Width</td>
                        <td class="metric-val">{{ assessment.width|default:"--" }} cm</td>
                        <td class="status-col">Current</td>
                    </tr>
                    <tr>
                        <td class="metric-name">Avg Depth</td>
                        <td class="metric-val">{{ assessment.depth|default:"--" }} cm</td>
                        <td class="status-col">Current</td>
                    </tr>
                    <tr>
                        <td class="metric-name">Reduction Rate</td>
                        <td style="font-weight: 800; font-size: 11pt;
                            {% if assessment.reduction_rate %}
                                {% if assessment.reduction_rate > 0 %}color: #16a34a;{% else %}color: #ef4444;{% endif %}
                            {% endif %}">
                            {% if assessment.reduction_rate is not None %}
                            {{ assessment.reduction_rate }}%
                            {% else %}
                            Initial
                            {% endif %}
                        </td>
                        <td style="font-weight: 700;
                            {% if assessment.reduction_rate %}
                                {% if assessment.reduction_rate > 0 %}color: #16a34a;{% else %}color: #ef4444;{% endif %}
                            {% endif %}">
                            {% if assessment.reduction_rate > 0 %}Improving{% elif assessment.reduction_rate < 0
                                %}Worsening{% else %}-{% endif %} </td>
                    </tr>
                    <tr>
                        <td class="metric-name">AI Confidence</td>
                        <td class="metric-val">{{ assessment.confidence_score|default:"N/A" }}%</td>
                        <td class="status-col">Telemetry</td>
                    </tr>
                    {% if assessment.healing_index %}
                    <tr>
                        <td class="metric-name">Healing Index</td>
                        <td class="metric-val">{{ assessment.healing_index }}</td>
                        <td class="status-col">AI Score</td>
                    </tr>
                    {% endif %}
                </table>
            </td>

            <!-- RIGHT COLUMN -->
            <td style="width: 218pt; vertical-align: top; padding-left: 0pt;">

                <!-- Section 3: Tissue Composition -->
                <div class="section-header"><span class="section-num">3</span> Tissue Composition</div>
                <div style="margin-bottom: 18pt;">
                    <!-- Granulation -->
                    <table class="comp-label-row">
                        <tr>
                            <td style="font-size: 9.75pt; font-weight: 500; color: #0f172a; padding-bottom: 3pt;">
                                Granulation</td>
                            <td
                                style="text-align: right; font-size: 9.75pt; font-weight: 600; color: #0f172a; padding-bottom: 3pt;">
                                {{ ml_result.tissue_composition.granulation|default:0 }}%</td>
                        </tr>
                    </table>
                    <table class="comp-bar-row">
                        <tr>
                            <td
                                style="background-color: #22c55e; border-radius: 3pt; height: 6pt; width: {{ ml_result.tissue_composition.granulation|default:0 }}%;">
                            </td>
                            <td style="height: 6pt;"></td>
                        </tr>
                    </table>

                    <!-- Slough -->
                    <table class="comp-label-row">
                        <tr>
                            <td style="font-size: 9.75pt; font-weight: 500; color: #0f172a; padding-bottom: 3pt;">Slough
                            </td>
                            <td
                                style="text-align: right; font-size: 9.75pt; font-weight: 600; color: #0f172a; padding-bottom: 3pt;">
                                {{ ml_result.tissue_composition.slough|default:0 }}%</td>
                        </tr>
                    </table>
                    <table class="comp-bar-row">
                        <tr>
                            <td
                                style="background-color: #f59e0b; border-radius: 3pt; height: 6pt; width: {{ ml_result.tissue_composition.slough|default:0 }}%;">
                            </td>
                            <td style="height: 6pt;"></td>
                        </tr>
                    </table>

                    <!-- Necrotic -->
                    <table class="comp-label-row">
                        <tr>
                            <td style="font-size: 9.75pt; font-weight: 500; color: #0f172a; padding-bottom: 3pt;">
                                Necrotic</td>
                            <td
                                style="text-align: right; font-size: 9.75pt; font-weight: 600; color: #0f172a; padding-bottom: 3pt;">
                                {{ ml_result.tissue_composition.necrotic|default:0 }}%</td>
                        </tr>
                    </table>
                    <table class="comp-bar-row">
                        <tr>
                            <td
                                style="background-color: #ef4444; border-radius: 3pt; height: 6pt; width: {{ ml_result.tissue_composition.necrotic|default:0 }}%;">
                            </td>
                            <td style="height: 6pt;"></td>
                        </tr>
                    </table>
                </div>

                <!-- Section 4: AI Analysis Notes -->
                <div class="section-header"><span class="section-num">4</span> AI Analysis Notes</div>
                <div class="analysis-box">
                    <!-- AI Wound Analysis -->
                    <div style="margin-bottom: 10pt;">
                        <div class="analysis-title">AI Wound Analysis:</div>
                        <div class="analysis-text" style="margin-bottom: 0;">
                            {{ ml_result.wound_type|default:assessment.wound_type|default:"N/A" }}
                            {% if ml_result.stage %} - {{ ml_result.stage }}{% elif assessment.wound_stage %} - {{
                            assessment.wound_stage }}{% endif %}
                        </div>
                    </div>

                    <!-- Clinical Notes -->
                    <div>
                        <div class="analysis-title">Clinical Notes:</div>
                        <div class="analysis-text" style="margin-bottom: 0;">{{ assessment.notes|default:"No clinical
                            notes provided." }}</div>
                    </div>
                </div>

                <!-- Cure Recommendation -->
                {% if assessment.cure_recommendation %}
                <div class="rec-box" style="margin-top: 10pt;">
                    <div class="rec-title">Recommended Cure Process:</div>
                    <div class="rec-text">{{ assessment.cure_recommendation }}</div>
                </div>
                {% endif %}

                <!-- Algorithm Analysis Summary -->
                {% if ml_result.algorithm_analysis %}
                <div style="margin-top: 12pt; background: #f8fafc; border-radius: 6pt; padding: 10pt;">
                    <div class="analysis-title" style="margin-bottom: 6pt;">Algorithm Details:</div>
                    {% if ml_result.algorithm_analysis.segmentation %}
                    <div style="font-size: 8.5pt; color: #475569; margin-bottom: 3pt;">
                        <b>Segmentation:</b> {{ ml_result.algorithm_analysis.segmentation }}
                    </div>
                    {% endif %}
                    {% if ml_result.algorithm_analysis.classification %}
                    <div style="font-size: 8.5pt; color: #475569; margin-bottom: 3pt;">
                        <b>Classification:</b> {{ ml_result.algorithm_analysis.classification }}
                    </div>
                    {% endif %}
                    {% if ml_result.algorithm_analysis.wound_area_mm2 %}
                    <div style="font-size: 8.5pt; color: #475569;">
                        <b>Estimated Area:</b> {{ ml_result.algorithm_analysis.wound_area_mm2 }} mm²
                    </div>
                    {% endif %}
                </div>
                {% endif %}

            </td>
        </tr>
    </table>

    <!-- Footer -->
    <table class="full-width footer">
        <tr>
            <td style="width: 33%;">Page 1 of 1</td>
            <td style="width: 33%; text-align: center;">Confidential Medical Record • Do Not Distribute</td>
            <td style="width: 33%; text-align: right;">ID: RPT-{{ patient.mrn }}-{{ assessment.id }}</td>
        </tr>
    </table>
</body>

</html>